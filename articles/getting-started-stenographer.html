<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with stenographer • stenographer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with stenographer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stenographer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started-stenographer.html">Getting Started with stenographer</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/donate.html">Donate</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dereckmezquita/stenographer" target="_blank"><span class="fa fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.youtube.com/@derecksyoutube" target="_blank"><span class="fa fa-youtube fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://derecksprojects.com" target="_blank">derecksprojects.com</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://derecksnotes.com" target="_blank">derecksnotes.com</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with stenographer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dereckmezquita/stenographer/blob/DT-19-stenographer-from-R-Logger-rename/vignettes/getting-started-stenographer.Rmd" class="external-link"><code>vignettes/getting-started-stenographer.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started-stenographer.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>stenographer</code> package provides a flexible and
powerful logging system for R applications. It includes a
<code>Stenographer</code> class for creating customisable loggers, as
well as helper functions for debugging and error reporting. This
vignette will guide you through the basics of using the
<code>stenographer</code> package and demonstrate how to leverage its
features to improve your R workflows.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of stenographer from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"stenographer"</span><span class="op">)</span></span></code></pre></div>
<p>You can install stenographer from <a href="https://github.com/dereckmezquita/stenographer" class="external-link">www.github.com/dereckmezquita/stenographer</a>
with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"dereckmezquita/stenographer"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>First, let’s load the package and create a basic stenographer:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">stenographer</span><span class="op">[</span><span class="va">Stenographer</span>, <span class="va">LogLevel</span>, <span class="va">messageParallel</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a basic logger</span></span>
<span><span class="va">steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log some messages</span></span>
<span><span class="va">steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"This is an informational message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:44.947Z</span> <span style="color: #0000BB;">INFO   </span> <span style="color: #BBBBBB;">This is an informational message</span></span></span>
<span><span class="va">steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="st">"This is a warning"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:44.951Z</span> <span style="color: #BBBB00;">WARNING</span> <span style="color: #BBBBBB;">This is a warning</span></span></span>
<span><span class="va">steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"This is an error"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:44.985Z</span> <span style="color: #BB0000;">ERROR  </span> <span style="color: #BBBBBB;">This is an error</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="customising-the-stenographer">Customising the Stenographer<a class="anchor" aria-label="anchor" href="#customising-the-stenographer"></a>
</h2>
<p>You can customise the <code>Stenographer</code> by specifying the
minimum log level, output file, and custom print function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a custom stenographer</span></span>
<span><span class="va">custom_steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    level <span class="op">=</span> <span class="va">LogLevel</span><span class="op">$</span><span class="va">WARNING</span>,</span>
<span>    file_path <span class="op">=</span> <span class="st">"app.log"</span>,</span>
<span>    print_fn <span class="op">=</span> <span class="va">message</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"This won't be logged"</span><span class="op">)</span></span>
<span><span class="va">custom_steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="st">"This will be logged to console and file"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.183Z</span> <span style="color: #BBBB00;">WARNING</span> <span style="color: #BBBBBB;">This will be logged to console and file</span></span></span>
<span><span class="va">custom_steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"This is an error message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.184Z</span> <span style="color: #BB0000;">ERROR  </span> <span style="color: #BBBBBB;">This is an error message</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="logging-to-a-database">Logging to a Database<a class="anchor" aria-label="anchor" href="#logging-to-a-database"></a>
</h2>
<p>The <code>Stenographer</code> class supports logging to a
<code>SQLite</code> database. Here’s how you can set it up:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">RSQLite</span><span class="op">[</span> <span class="va">SQLite</span> <span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">DBI</span><span class="op">[</span> <span class="va">dbConnect</span>, <span class="va">dbDisconnect</span>, <span class="va">dbGetQuery</span> <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a database connection</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">"log.sqlite"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a Stenographer that logs to the database</span></span>
<span><span class="va">db_steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    db_conn <span class="op">=</span> <span class="va">db</span>,</span>
<span>    table_name <span class="op">=</span> <span class="st">"app_logs"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log some messages</span></span>
<span><span class="va">db_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"This is logged to the database"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.452Z</span> <span style="color: #0000BB;">INFO   </span> <span style="color: #BBBBBB;">This is logged to the database</span></span></span>
<span><span class="va">db_steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="st">"This is a warning"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>code <span class="op">=</span> <span class="fl">101</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.462Z</span> <span style="color: #BBBB00;">WARNING</span> <span style="color: #BBBBBB;">This is a warning</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">Data:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "code": 101</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">db_steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"An error occurred"</span>, error <span class="op">=</span> <span class="st">"Division by zero"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.570Z</span> <span style="color: #BB0000;">ERROR  </span> <span style="color: #BBBBBB;">An error occurred</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Error:</span></span></span>
<span><span class="co">#&gt; "Division by zero"</span></span>
<span></span>
<span><span class="co"># Example of querying the logs</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"SELECT * FROM app_logs WHERE level = 'ERROR'"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">db</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id                 datetime level context               msg data</span></span>
<span><span class="co">#&gt; 1  3 2025-01-12T19:36:45.570Z ERROR    &lt;NA&gt; An error occurred &lt;NA&gt;</span></span>
<span><span class="co">#&gt;                          error</span></span>
<span><span class="co">#&gt; 1 ["[\\"Division by zero\\"]"]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-context">Using Context<a class="anchor" aria-label="anchor" href="#using-context"></a>
</h2>
<p>The <code>Stenographer</code> class supports a context feature, which
allows you to add persistent information to your log entries:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">context_steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    db_conn <span class="op">=</span> <span class="va">db</span>,</span>
<span>    table_name <span class="op">=</span> <span class="st">"context_logs"</span>,</span>
<span>    context <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>app_name <span class="op">=</span> <span class="st">"MyApp"</span>, version <span class="op">=</span> <span class="st">"1.0.0"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"Application started"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.652Z</span> <span style="color: #0000BB;">INFO   </span> <span style="color: #BBBBBB;">Application started</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB00BB;">Context:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "app_name": "MyApp",</span></span>
<span><span class="co">#&gt;   "version": "1.0.0"</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="co"># Update context</span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">update_context</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>user_id <span class="op">=</span> <span class="st">"12345"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"User logged in"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.663Z</span> <span style="color: #0000BB;">INFO   </span> <span style="color: #BBBBBB;">User logged in</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB00BB;">Context:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "app_name": "MyApp",</span></span>
<span><span class="co">#&gt;   "version": "1.0.0",</span></span>
<span><span class="co">#&gt;   "user_id": "12345"</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="co"># Log an error with context</span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"Operation failed"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"data_fetch"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.674Z</span> <span style="color: #BB0000;">ERROR  </span> <span style="color: #BBBBBB;">Operation failed</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">Data:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "operation": "data_fetch"</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; <span style="color: #BB00BB;">Context:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "app_name": "MyApp",</span></span>
<span><span class="co">#&gt;   "version": "1.0.0",</span></span>
<span><span class="co">#&gt;   "user_id": "12345"</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="co"># Example of querying logs with context</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"SELECT * FROM context_logs WHERE json_extract(context, '$.user_id') = '12345'"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">db</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] id       datetime level    context  msg      data     error   </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span></span>
<span><span class="co"># Clear context</span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">clear_context</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">context_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"Context cleared"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.688Z</span> <span style="color: #0000BB;">INFO   </span> <span style="color: #BBBBBB;">Context cleared</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combining-features">Combining Features<a class="anchor" aria-label="anchor" href="#combining-features"></a>
</h2>
<p>You can combine various features of the <code>Stenographer</code>
class to create a powerful logging system:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a combined Stenographer</span></span>
<span><span class="va">combined_steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    level <span class="op">=</span> <span class="va">LogLevel</span><span class="op">$</span><span class="va">INFO</span>,</span>
<span>    file_path <span class="op">=</span> <span class="st">"combined_app.log"</span>,</span>
<span>    db_conn <span class="op">=</span> <span class="va">db</span>,</span>
<span>    table_name <span class="op">=</span> <span class="st">"combined_logs"</span>,</span>
<span>    context <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>app_name <span class="op">=</span> <span class="st">"CombinedApp"</span>, version <span class="op">=</span> <span class="st">"2.0.0"</span><span class="op">)</span>,</span>
<span>    print_fn <span class="op">=</span> <span class="va">messageParallel</span>,</span>
<span>    format_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">level</span>, <span class="va">msg</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># manipulate the message before logging</span></span>
<span>        <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"API_KEY=[^\\s]+"</span>, <span class="st">"API_KEY=***"</span>, <span class="va">msg</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">msg</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log some messages</span></span>
<span><span class="va">combined_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"Application started"</span><span class="op">)</span></span>
<span><span class="va">combined_steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="st">"Low memory"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>available_mb <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combined_steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"Database connection failed"</span>, error <span class="op">=</span> <span class="st">"Connection timeout"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update context</span></span>
<span><span class="va">combined_steno</span><span class="op">$</span><span class="fu">update_context</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>user_id <span class="op">=</span> <span class="st">"67890"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combined_steno</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"User action"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>action <span class="op">=</span> <span class="st">"button_click"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example of a more complex query using context and data</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">SELECT *</span></span>
<span><span class="st">FROM combined_logs</span></span>
<span><span class="st">WHERE json_extract(context, '$.app_name') = 'CombinedApp'</span></span>
<span><span class="st">  AND json_extract(data, '$.available_mb') &lt; 200</span></span>
<span><span class="st">"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">db</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] id       datetime level    context  msg      data     error   </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span></span>
<span><span class="co"># Don't forget to close the database connection when you're done</span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-helper-functions">Using Helper Functions<a class="anchor" aria-label="anchor" href="#using-helper-functions"></a>
</h2>
<p>The <code>Stenographer</code> package includes several helper
functions that can be used in conjunction with the
<code>Stenographer</code> class to provide more detailed information in
your logs. Let’s explore how to use these functions effectively.</p>
<div class="section level3">
<h3 id="finding-and-logging-data-issues">Finding and Logging Data Issues<a class="anchor" aria-label="anchor" href="#finding-and-logging-data-issues"></a>
</h3>
<p>Suppose we have a dataset with some problematic values, and we want
to log where these issues occur. We can use the
<code>valueCoordinates</code> function to locate the problematic values
and include this information in our log messages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">stenographer</span><span class="op">[</span><span class="va">valueCoordinates</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a sample dataset with some issues</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a Stenographer</span></span>
<span><span class="va">steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find coordinates of NA values</span></span>
<span><span class="va">na_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/valueCoordinates.html">valueCoordinates</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">na_coords</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span></span>
<span>        <span class="st">"NA values found in the dataset"</span>,</span>
<span>        data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            na_locations <span class="op">=</span> <span class="va">na_coords</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.896Z</span> <span style="color: #BBBB00;">WARNING</span> <span style="color: #BBBBBB;">NA values found in the dataset</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">Data:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "na_locations": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "column": 1,</span></span>
<span><span class="co">#&gt;       "row": 2</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "column": 2,</span></span>
<span><span class="co">#&gt;       "row": 3</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "column": 3,</span></span>
<span><span class="co">#&gt;       "row": 4</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   ]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This will produce a log entry like:</p>
</div>
<div class="section level3">
<h3 id="logging-errors-with-context">Logging Errors with Context<a class="anchor" aria-label="anchor" href="#logging-errors-with-context"></a>
</h3>
<p>When an error occurs, it’s often useful to catch and log not just the
error message, but also the context in which the error occurred. Here’s
an example of how to do this using the <code>Stenographer</code> class
and helper functions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">stenographer</span><span class="op">[</span><span class="va">tableToString</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">process_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">a</span> <span class="op">/</span> <span class="va">df</span><span class="op">$</span><span class="va">b</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">inf_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/valueCoordinates.html">valueCoordinates</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>            <span class="va">steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span></span>
<span>                <span class="st">"Division by zero occurred"</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    infinite_values <span class="op">=</span> <span class="va">inf_coords</span>,</span>
<span>                    dataset_preview <span class="op">=</span> <span class="fu"><a href="../reference/tableToString.html">tableToString</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Division by zero error"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">steno</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"An error occurred while processing data:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset_preview <span class="op">=</span> <span class="fu"><a href="../reference/tableToString.html">tableToString</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            error <span class="op">=</span> <span class="va">e</span></span>
<span>        <span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function with problematic data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">process_data</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2025-01-12T19:36:45.998Z</span> <span style="color: #BB0000;">ERROR  </span> <span style="color: #BBBBBB;">Division by zero occurred</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">Data:</span></span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "infinite_values": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "column": 1,</span></span>
<span><span class="co">#&gt;       "row": 1</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "column": 1,</span></span>
<span><span class="co">#&gt;       "row": 3</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "dataset_preview": "  a b\n1 1 0\n2 2 2\n3 3 0"</span></span>
<span><span class="co">#&gt; } </span></span>
<span><span class="co">#&gt; Division by zero error</span></span>
<span><span class="co">#&gt; [1] Inf   1 Inf</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="logging-in-parallel-environments">Logging in Parallel Environments<a class="anchor" aria-label="anchor" href="#logging-in-parallel-environments"></a>
</h2>
<p>When working with parallel processing, standard logging functions
might not work as expected. The stenographer package provides a
<code>messageParallel</code> function to ensure messages are properly
logged from parallel processes:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">future</span><span class="op">)</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">future.apply</span><span class="op">[</span><span class="va">future_lapply</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">steno</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Stenographer.html">Stenographer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>print_fn <span class="op">=</span> <span class="va">messageParallel</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/messageParallel.html">messageParallel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Processing item %d"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">steno</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Warning for item %d"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/sequential.html" class="external-link">sequential</a></span><span class="op">)</span></span></code></pre></div>
<p>This ensures that messages from parallel processes are properly
captured and logged.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The stenographer package provides a robust and flexible logging
system for R applications. With features like file logging, database
logging, and context management, you can create informative and
context-rich log messages that greatly aid in debugging and monitoring
your R scripts and applications.</p>
<p>Moreover, by using helper functions like
<code>valueCoordinates</code> and <code>tableToString</code> you can
more easily track down and log data issues and errors, providing
valuable information for troubleshooting and analysis.</p>
<p>Remember to adjust the log level, output file, database settings, and
other parameters to suit your specific needs. The ability to query logs
using SQL, especially with context-based filtering, makes it easy to
analyze and troubleshoot issues in your applications.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://derecksnotes.com" class="external-link">Dereck Mezquita</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
